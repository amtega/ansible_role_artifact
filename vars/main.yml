---
# Role variables

# Artifact types supported

artifact_types_supported:
  - gitlab
  - http
  - jenkins
  - maven

# Defaults for error handling

artifact_retries: 3
artifact_delay: 1

# Defaults for checksum

artifact_checksum_algorithm: sha256

# Artifact list to manage (included the items loaded from hostvars)

artifact_to_manage: >-
  {{ artifact_list
     + ((artifact_load_from_hostvars | bool)
        | ternary(artifact_hostvars | default([]) | flatten, [])) }}

artifact_to_manage_undefined: >-
  {{ artifact_to_manage
     | selectattr("state", "undefined")
     | list }}

artifact_to_manage_present: >-
  {{ artifact_to_manage
     | selectattr("state", "defined")
     | selectattr("state", "equalto", "present")
     | list
     + artifact_to_manage_undefined }}

artifact_to_manage_absent: >-
  {{ artifact_to_manage
     | selectattr("state", "defined")
     | selectattr("state", "equalto", "absent")
     | list }}

# Specific types artifact list to manage

artifact_to_manage_present_gitlab: >-
  {{ artifact_to_manage_present
     | selectattr("type", "in", ["gitlab", "github"])
     | list }}

artifact_to_manage_present_http: >-
  {{ artifact_to_manage_present
     | selectattr('type', "in", ["http", "https"])
     | list }}

artifact_to_manage_present_jenkins: >-
  {{ artifact_to_manage_present
     | selectattr("type", "in", ["jenkins"])
     | list }}

artifact_to_manage_present_maven: >-
  {{ artifact_to_manage_present
     | selectattr("type", "in", ["maven"])
     | list }}

# Unarchive artifacts

artifact_to_manage_present_unarchive_all: >-
  {{ artifact_to_manage_present
     | selectattr("unarchive", "defined")
     | selectattr("unarchive", "equalto", True)
     | list }}

artifact_to_manage_present_unarchive_run_once: >-
  {{ artifact_to_manage_present_unarchive_all
     | selectattr("run_once", "defined")
     | selectattr("run_once", "equalto", True)
     | list }}

artifact_to_manage_present_unarchive_run_n: >-
  {{ artifact_to_manage_present_unarchive_all
     | difference(artifact_to_manage_present_unarchive_run_once) }}
