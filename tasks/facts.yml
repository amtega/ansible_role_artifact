---
# Role facts tasks

- block:
    - name: Setup artifacts facts
      set_fact:
        artifact_result: >-
          {{ lookup("template", "facts.yml.j2") | from_yaml }}

    - name: Create custom facts directory
      file:
        path: /etc/ansible/facts.d
        state: directory

    - name: Configure artifact facts
      template:
        src: facts.fact.j2
        dest: >-
          /etc/ansible/facts.d/artifact_{{ artifact_id }}.fact
        owner: root
        group: root
        mode: 0640
      loop: >-
        {{ artifact_result.keys()
           | list
           | difference(artifact_to_manage_absent
                        | map(attribute="id") | list) }}
      loop_control:
        loop_var: artifact_id

    - name: Remove obsolete artifact facts file
      file:
        path: /etc/ansible/facts.d/artifact.fact
        state: absent
  tags:
    - role::artifact
    - role::artifact::facts
